// Copyright (c) 2023 The Stdlib Authors. License is Apache-2.0: http://www.apache.org/licenses/LICENSE-2.0
/// <reference types="./index.d.ts" />
import e from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-array@esm/index.mjs";import t from"https://cdn.jsdelivr.net/gh/stdlib-js/error-tools-fmtprodmsg@v0.0.2-esm/index.mjs";import r from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-copy@esm/index.mjs";import s from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-nonenumerable-read-only-accessor@esm/index.mjs";import n from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-nonenumerable-read-only-property@esm/index.mjs";import i from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-positive-integer@esm/index.mjs";import a,{isPrimitive as o}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-boolean@esm/index.mjs";import l from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-pow@v0.0.7-esm/index.mjs";import d from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-max@esm/index.mjs";import{isPrimitive as h}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-nonnegative-number@esm/index.mjs";import{isPrimitive as p}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-positive-number@esm/index.mjs";import c from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-plain-object@esm/index.mjs";import{isPrimitive as m}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-string@esm/index.mjs";import u from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-has-own-property@esm/index.mjs";function f(e,r){var s;if(!(this instanceof f))return new f(e,r);if(!i(e))throw new TypeError(t("0LT4o",e));if(!a(r))throw new TypeError(t("0LT6G",r));for(this.scale=1,this.norm=0,this.intercept=r,this.nWeights=e+(this.intercept?1:0),this._data=new Array(this.nWeights),s=0;s<this.nWeights;s++)this._data[s]=0}n(f.prototype,"scaleTo",(function(e){var r;if(this.scale<1e-11){for(r=0;r<this.nWeights;r++)this._data[r]*=this.scale;this.scale=1}if(this.norm*=l(e,2),!(e>0))throw new RangeError(t("unexpected error. Scaling weight vector by nonpositive value, likely due to too large value of eta * lambda. Value: `%f`.",e));this.scale*=e})),n(f.prototype,"add",(function(e,t){var r,s,n;for(s=0,void 0===t&&(t=1),n=0;n<e.length;n++)r=e[n]*t,s+=this._data[n]*r,this._data[n]=this._data[n]+r/this.scale;this.intercept&&(r=1*t,s+=this._data[n]*r,this._data[n]=this._data[n]+r/this.scale),this.norm+=(function(e,t){var r,s=e.length,n=0;for(r=0;r<s;r++)n+=e[r]*t[r];return n}(e,e)+(this.intercept?1:0))*l(t,2)+2*this.scale*s})),n(f.prototype,"innerProduct",(function(e){var t,r=0;for(t=0;t<e.length;t++)r+=this._data[t]*e[t];return r+=this.intercept?this._data[t]:0,r*=this.scale}));function g(e,t,r){var s;t>0&&(s=1-r*t,e.scaleTo(d(s,1e-7)))}function v(e,t,r,s,n,i){var a=e.innerProduct(t)-r;g(e,n,s),a>i?e.add(t,-s):a<-i&&e.add(t,+s)}function b(e,t,r,s,n){var i=r-e.innerProduct(t);g(e,n,s),e.add(t,s*i)}function j(e,t,r,s,n,i){var a=e.innerProduct(t)-r;g(e,n,s),a>i?e.add(t,-s):a<-i?e.add(t,+s):e.add(t,-s*a)}function w(e,r,s){var n,i;switch(n=1,e){case"basic":i=function(){var e=1e3/(n+1e3);return n+=1,e};break;case"constant":i=function(){return n+=1,r};break;case"pegasos":i=function(){var e=1/(s*n);return n+=1,e};break;default:throw new Error(t("0LT3t","learningRate",["basic","constant","pegasos"].join('", "'),e))}return i}var y={epsilon:.1,eta0:.02,intercept:!0,lambda:.001,learningRate:"basic",loss:"squaredError"};function T(e,r){return c(r)?u(r,"epsilon")&&(e.epsilon=r.epsilon,!p(e.epsilon))?new TypeError(t("0LT4Q","epsilon",e.epsilon)):u(r,"eta0")&&(e.eta0=r.eta0,!p(e.eta0))?new TypeError(t("0LT4Q","eta0",e.eta0)):u(r,"lambda")&&(e.lambda=r.lambda,!h(e.lambda))?new TypeError(t("0LT4x","lambda",e.lambda)):u(r,"learningRate")&&(e.learningRate=r.learningRate,!m(e.learningRate))?new TypeError(t("0LT2i","learningRate",e.learningRate)):u(r,"loss")&&(e.loss=r.loss,!m(e.loss))?new TypeError(t("0LT2i","loss",e.loss)):u(r,"intercept")&&(e.intercept=r.intercept,!o(e.intercept))?new TypeError(t("0LT30","intercept",e.intercept)):null:new TypeError(t("0LT2h",r))}function x(i){var a,o,l,d,h,p,c;if(p=r(y),arguments.length>0&&(c=T(p,i)))throw c;switch(l=null,p.loss){case"epsilonInsensitive":o=v;break;case"huber":o=j;break;case"squaredError":o=b;break;default:throw Error(t('invalid option. `%s` option must be one of the following: "%s". Option: `%s`.',"loss",["epsilonInsensitive","huber","squaredError"].join('", "'),p.loss))}function h(r,s){var n;if(!e(r))throw new TypeError(t("0LTBj",r));if(l||(l=new f(r.length,p.intercept),a=p.intercept?l.nWeights-1:l.nWeights),r.length!==a)throw new TypeError(t("invalid argument. First argument must be an array of length %u. Value: `%s`.",a,r));n=d(),o(l,r,s,n,p.lambda,p.epsilon)}return d=w(p.learningRate,p.eta0,p.lambda),s(h,"coefs",m),n(h,"predict",u),h;function m(){var e,t;for(e=new Array(l.nWeights),t=0;t<e.length;t++)e[t]=l._data[t]*l.scale;return e}function u(r){if(!e(r)||r.length!==a)throw new TypeError(t("invalid argument. First argument must be an array of length %u. Value: `%s`.",a||0,r));return l.innerProduct(r)}}export{x as default};
//# sourceMappingURL=index.mjs.map
