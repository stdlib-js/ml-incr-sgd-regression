// Copyright (c) 2024 The Stdlib Authors. License is Apache-2.0: http://www.apache.org/licenses/LICENSE-2.0
/// <reference types="./index.d.ts" />
import t from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-array@v0.1.1-esm/index.mjs";import e from"https://cdn.jsdelivr.net/gh/stdlib-js/string-format@v0.1.1-esm/index.mjs";import n from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-copy@v0.1.0-esm/index.mjs";import s from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-nonenumerable-read-only-accessor@v0.1.0-esm/index.mjs";import i from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-nonenumerable-read-only-property@v0.1.0-esm/index.mjs";import r from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-positive-integer@v0.1.0-esm/index.mjs";import a,{isPrimitive as o}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-boolean@v0.1.1-esm/index.mjs";import l from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-pow@v0.1.0-esm/index.mjs";import d from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-max@v0.1.1-esm/index.mjs";import{isPrimitive as p}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-nonnegative-number@v0.1.1-esm/index.mjs";import{isPrimitive as m}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-positive-number@v0.1.1-esm/index.mjs";import h from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-plain-object@v0.1.0-esm/index.mjs";import{isPrimitive as u}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-string@v0.1.1-esm/index.mjs";import c from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-has-own-property@v0.1.1-esm/index.mjs";function v(t,n){var s;if(!(this instanceof v))return new v(t,n);if(!r(t))throw new TypeError(e("invalid argument. First argument must be a positive integer. Value: `%s`.",t));if(!a(n))throw new TypeError(e("invalid argument. Second argument must be a boolean. Value: `%s`.",n));for(this.scale=1,this.norm=0,this.intercept=n,this.nWeights=t+(this.intercept?1:0),this._data=new Array(this.nWeights),s=0;s<this.nWeights;s++)this._data[s]=0}i(v.prototype,"scaleTo",(function(t){var n;if(this.scale<1e-11){for(n=0;n<this.nWeights;n++)this._data[n]*=this.scale;this.scale=1}if(this.norm*=l(t,2),!(t>0))throw new RangeError(e("unexpected error. Scaling weight vector by nonpositive value, likely due to too large value of eta * lambda. Value: `%f`.",t));this.scale*=t})),i(v.prototype,"add",(function(t,e){var n,s,i;for(s=0,void 0===e&&(e=1),i=0;i<t.length;i++)n=t[i]*e,s+=this._data[i]*n,this._data[i]=this._data[i]+n/this.scale;this.intercept&&(n=1*e,s+=this._data[i]*n,this._data[i]=this._data[i]+n/this.scale),this.norm+=(function(t,e){var n,s=t.length,i=0;for(n=0;n<s;n++)i+=t[n]*e[n];return i}(t,t)+(this.intercept?1:0))*l(e,2)+2*this.scale*s})),i(v.prototype,"innerProduct",(function(t){var e,n=0;for(e=0;e<t.length;e++)n+=this._data[e]*t[e];return n+=this.intercept?this._data[e]:0,n*=this.scale}));function g(t,e,n){var s;e>0&&(s=1-n*e,t.scaleTo(d(s,1e-7)))}function b(t,e,n,s,i,r){var a=t.innerProduct(e)-n;g(t,i,s),a>r?t.add(e,-s):a<-r&&t.add(e,+s)}function f(t,e,n,s,i){var r=n-t.innerProduct(e);g(t,i,s),t.add(e,s*r)}function j(t,e,n,s,i,r){var a=t.innerProduct(e)-n;g(t,i,s),a>r?t.add(e,-s):a<-r?t.add(e,+s):t.add(e,-s*a)}function w(t,n,s){var i,r;switch(i=1,t){case"basic":r=function(){var t=1e3/(i+1e3);return i+=1,t};break;case"constant":r=function(){return i+=1,n};break;case"pegasos":r=function(){var t=1/(s*i);return i+=1,t};break;default:throw new Error(e('invalid option. `%s` option must be one of the following: "%s". Option: `%s`.',"learningRate",["basic","constant","pegasos"].join('", "'),t))}return r}var y={epsilon:.1,eta0:.02,intercept:!0,lambda:.001,learningRate:"basic",loss:"squaredError"};function E(t,n){return h(n)?c(n,"epsilon")&&(t.epsilon=n.epsilon,!m(t.epsilon))?new TypeError(e("invalid option. `%s` option must be a positive number. Option: `%s`.","epsilon",t.epsilon)):c(n,"eta0")&&(t.eta0=n.eta0,!m(t.eta0))?new TypeError(e("invalid option. `%s` option must be a positive number. Option: `%s`.","eta0",t.eta0)):c(n,"lambda")&&(t.lambda=n.lambda,!p(t.lambda))?new TypeError(e("invalid option. `%s` option must be a nonnegative number. Option: `%s`.","lambda",t.lambda)):c(n,"learningRate")&&(t.learningRate=n.learningRate,!u(t.learningRate))?new TypeError(e("invalid option. `%s` option must be a string. Option: `%s`.","learningRate",t.learningRate)):c(n,"loss")&&(t.loss=n.loss,!u(t.loss))?new TypeError(e("invalid option. `%s` option must be a string. Option: `%s`.","loss",t.loss)):c(n,"intercept")&&(t.intercept=n.intercept,!o(t.intercept))?new TypeError(e("invalid option. `%s` option must be a boolean. Option: `%s`.","intercept",t.intercept)):null:new TypeError(e("invalid argument. Options argument must be an object. Value: `%s`.",n))}function x(r){var a,o,l,d,p,m,h;if(m=n(y),arguments.length>0&&(h=E(m,r)))throw h;switch(l=null,m.loss){case"epsilonInsensitive":o=b;break;case"huber":o=j;break;case"squaredError":o=f;break;default:throw Error(e('invalid option. `%s` option must be one of the following: "%s". Option: `%s`.',"loss",["epsilonInsensitive","huber","squaredError"].join('", "'),m.loss))}function p(n,s){var i;if(!t(n))throw new TypeError(e("invalid argument. First argument must be an array. Value: `%s`.",n));if(l||(l=new v(n.length,m.intercept),a=m.intercept?l.nWeights-1:l.nWeights),n.length!==a)throw new TypeError(e("invalid argument. First argument must be an array of length %u. Value: `%s`.",a,n));i=d(),o(l,n,s,i,m.lambda,m.epsilon)}return d=w(m.learningRate,m.eta0,m.lambda),s(p,"coefs",u),i(p,"predict",c),p;function u(){var t,e;for(t=new Array(l.nWeights),e=0;e<t.length;e++)t[e]=l._data[e]*l.scale;return t}function c(n){if(!t(n)||n.length!==a)throw new TypeError(e("invalid argument. First argument must be an array of length %u. Value: `%s`.",a||0,n));return l.innerProduct(n)}}export{x as default};
//# sourceMappingURL=index.mjs.map
